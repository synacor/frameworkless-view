!function(a,b){"function"==typeof define&&define.amd?define(["util","events","handlebars"],b):a.view=b(a.util,a.EventEmitter,a.handlebars)}(this,function(a,b,c){function d(a,b,c,d){return a&&b&&c&&d?(a._eventRegistry||(a._eventRegistry=[]),a._eventTypes||(a._eventTypes={}),a._eventTypes.hasOwnProperty(b)||(a.addEventListener(b,e),a._eventTypes[b]=!0),a._eventRegistry.push({type:b,selector:c,callback:d}),!0):!1}function e(a){var b,c,d=this._eventRegistry,e=a.target||a.srcElement,f=[];for(c=d.length;c--;)d[c].type===a.type&&f.push(d[c]);do for(c=f.length;c--;)if(b=f[c],g.call(e,b.selector)&&(a.currentTarget=a.delegationTarget=e,b.callback.call(e,a)===!1))return!1;while((e=e.parentNode)!==this.parentNode)}function f(b,d){return this instanceof f?("object"==typeof b&&(a.extend(this,b),b.events&&this.hookEvents(b.events,b),d=b.name,b=b.template||b.tpl),this.rawView=b,this.renderTemplate=c.compile(this.rawView),this.base=document.createElement("div"),d&&this.base.setAttribute("id",d+"-base"),this.base.className="view-base",this.base.innerHTML=this.rawView,this.name=d,void(this.name&&this.base.setAttribute("data-view",d))):new f(b,d)}var g,h=b.EventEmitter||b,i=(window.Element||document.createElement("div").constructor).prototype;return g=i.matches||i.webkitMatchesSelector||i.mozMatchesSelector||i.oMatchesSelector||function(a){for(var b=document.querySelectorAll(a),c=b.length;c--;)if(b[c]===this)return!0;return!1},a.inherits(f,h),a.extend(f.prototype,{render:function(a){return this.renderTemplate&&this.base?(this.templateData=a,this.base.innerHTML=a&&this.renderTemplate(a)||this.rawView,this):!1},template:function(a){return f.prototype.render.call(this,a)},hookEvents:function(a,b){var c,e,f,g,h;if(!this.base)return!1;this.events=a;for(h in a)if(a.hasOwnProperty(h)&&(c=h.split(" "),e=c[0],g=c.slice(1).join(" "),f=a[h],b&&"string"==typeof f&&(f=b[f]),!d(this.base,e,g,f)))throw new Error('Invalid event entry "'+h+'".');return this},insertInto:function(a){return"string"==typeof a&&(a=document.querySelector(a)),a.appendChild(this.base),this},insertAfter:function(a){return"string"==typeof a&&(a=document.querySelector(a)),a.parentNode.insertBefore(this.base,a.nextSibling),this},remove:function(){return this.base&&this.base.parentNode&&this.base.parentNode.removeChild(this.base),this},find:function(a){return Array.prototype.slice.call(this.base.querySelectorAll(a))},findOne:function(a){return this.base.querySelector(a)},$:function(a){return this.find(a)},$$:function(a){return this.findOne(a)}}),f.View=f.view=f,f});